<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/images/icon/mikuicon.jpg"><link rel="icon" href="/images/icon/mikuicon.jpg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="ZPC-dsg"><meta name="keywords" content=""><meta name="description" content="前言 在看Vulkan官方示例集的时候，我就有想法要将这个示例集用到的特性和实现的效果全部使用别的图形API实现一遍。个人而言比较熟悉的API是OpenGL，所以就先构建OpenGL版本的示例集了。当然在这之后我还打算构建相应的D3D11和D3D12版本，并且如果允许的话构建一个抽象层将不同API的实现整合起来。不过当然这些都是长远的打算了，现在还是一步一个脚印地记录一下OpenGL版本的程序构"><meta property="og:type" content="article"><meta property="og:title" content="Compute_nBody的OpenGL复现"><meta property="og:url" content="http://example.com/2025/02/07/CG_api/openGL/VKSample_OGL/compute_nbody/index.html"><meta property="og:site_name" content="ZPC の Blog"><meta property="og:description" content="前言 在看Vulkan官方示例集的时候，我就有想法要将这个示例集用到的特性和实现的效果全部使用别的图形API实现一遍。个人而言比较熟悉的API是OpenGL，所以就先构建OpenGL版本的示例集了。当然在这之后我还打算构建相应的D3D11和D3D12版本，并且如果允许的话构建一个抽象层将不同API的实现整合起来。不过当然这些都是长远的打算了，现在还是一步一个脚印地记录一下OpenGL版本的程序构"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/images/textbg/CG_api/vks_ogl_particle.jpg"><meta property="article:published_time" content="2025-02-07T14:15:43.000Z"><meta property="article:modified_time" content="2025-02-08T06:53:19.013Z"><meta property="article:author" content="ZPC-dsg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://example.com/images/textbg/CG_api/vks_ogl_particle.jpg"><meta name="referrer" content="no-referrer-when-downgrade"><title>Compute_nBody的OpenGL复现 - ZPC の Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"example.com",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:"measurement_id:G-X8N3TZCB57",tencent:{sid:null,cid:null},leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script src="/live2d-widget/autoload.js"></script><meta name="generator" content="Hexo 7.3.0"><script src="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.css"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>ZPC の Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/images/textbg/CG_api/vks_ogl_particle.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="Compute_nBody的OpenGL复现"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> ZPC-dsg </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2025-02-07 22:15" pubdate>2025年2月7日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 5.4k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 46 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">Compute_nBody的OpenGL复现</h1><div class="markdown-body"><h2 id="前言">前言</h2><p>在看Vulkan官方示例集的时候，我就有想法要将这个示例集用到的特性和实现的效果全部使用别的图形API实现一遍。个人而言比较熟悉的API是OpenGL，所以就先构建OpenGL版本的示例集了。当然在这之后我还打算构建相应的D3D11和D3D12版本，并且如果允许的话构建一个抽象层将不同API的实现整合起来。不过当然这些都是长远的打算了，现在还是一步一个脚印地记录一下OpenGL版本的程序构建过程吧。</p><p>经过几天的不懈努力，终于是完成了对于Vulkan官方示例集中的第一个示例<strong>compute_nbody</strong>的构建。由于我没有具体研究过示例集的架构和对图形API的封装，所以项目的架构上多少还是比较简陋的，不过这个架构将在我不断实现新特性的过程中不断完善，我的目标是仿照官方示例集的架构完成一个比较成熟的用于展现所有示例特性的OpenGL框架，中间肯定会随着我对于示例集框架理解的加深不断重构自己的框架，苯人萌新一枚，还望大佬轻喷。</p><p>即使是一个简陋的框架，这几天来我也没少被折磨，中间也是遇到了各种令人质壁分离的bug（毕竟还是经验不足，不过好在没有放弃，终于还是基本复现出了官方特性集中的效果（虽说相对而言要丑不少，不过性能和视觉效果上的优化会在之后慢慢进行），当渲染窗口终于脱离黑屏，展示出五彩斑斓的粒子效果时，我也总算是能长舒一口气了。这篇文章不会非常具体地介绍框架中的各种实现细节（毕竟也没啥好介绍的。。。），也不会具体介绍<strong>compute_nbody</strong>示例的实现原理（这在我博客的<a target="_blank" rel="noopener" href="https://zpc-dsg.github.io/2025/01/24/CG_api/vulkan/vulkan_samples/compute_nbody/"><code>另一篇文章</code></a>中已经有非常详细的分析了），而是会着重于记录在开发过程中自己遇到的各种问题以及最后找出的解决方案，也给之后的自己提个醒吧~</p><p>本项目的代码框架已经开源在<a target="_blank" rel="noopener" href="https://github.com/ZPC-dsg/VkSamples_OGL"><code>我的github仓库中</code></a>。</p><hr><h2 id="问题1无法解析的外部符号xxx">问题1：无法解析的外部符号XXX</h2><p>在初步架构好项目之后，编译运行，然后程序报了一堆无法解析的外部符号bug。。。初步判断这是没有在项目中包含相应的库文件导致的（我原来将子项目Component设置为了生成exe文件，然后将这些库文件路径添加到了它的属性页，但之后发现应该要将这个项目构建为静态库，但是静态库项目的属性页是没有链接器选项的，所以原来我以为添加了的那些库就没了），于是将所有用到的第三方库的.lib文件位置加入项目属性设置——链接器选项中的附加库目录，并将这些.lib文件添加至附加依赖项。然后重新生成项目，发现<strong>stb_image</strong>文件中的函数仍然报错无法解析的外部符号，想起来在使用<strong>stb_image</strong>的时候应该要自己创建一个源文件并且在源文件中定义宏<i><font color="Red">STB_IMAGE_IMPLEMENTATION</font></i>，于是添加上这个源文件之后彻底解决了无法解析的外部符号问题。</p><hr><h2 id="问题2已跳过nvoglv64.dll加载">问题2：已跳过nvoglv64.dll加载</h2><p>这个bug着实是折磨了我挺久，它的恶心之处在于程序直接就崩溃了，甚至连调试的机会都不给，调用堆栈也一点信息没有，只能看到VS在程序崩溃后弹出一个界面告诉你已跳过nvoglv64.dll加载blabla的（根本不知所云xs），属实是给我整不会了。。。。google了一圈发现还真有人遇到过类似的问题，而且我发现有一些帖子提到是在使用<strong>stb_image</strong>加载图像的时候遇到了这种问题。于是我决定写一个小的测试程序来检验一下我的问题根源是不是也是这个，遂写了一个简单的渲染全屏纹理的测试程序，然后先是随便使用了一张正常的jpg图像，发现加载正常测试程序正常运行，然后我再尝试使用该测试程序加载<strong>compute_nbody</strong>项目本应该用到的纹理图像时，发现相同的问题出现了，合着还真是这个图像加载库的问题。。。</p><p>回想起之前不知道在哪里看到过<strong>stb_image</strong>加载png文件很容易产生问题，而我的<strong>compute_nbody</strong>项目使用的那两张纹理是我截屏得到的。说起来获取这两张纹理的过程也十分曲折。。。因为Vulkan官方示例集所提供的相应纹理是<strong>ktx</strong>格式的，还不是一般的<strong>ktx</strong>格式（我也是服了），亲测一般的ktx转jpg工具对这些图像无效。。。（DirectX官方提供的都不行），在<a target="_blank" rel="noopener" href="https://zpc-dsg.github.io/2025/01/24/CG_api/vulkan/vulkan_samples/compute_nbody/"><code>我的分析compute_nbody逻辑细节</code></a>的文章中我提到自己最终是发现Vulkan官方示例集中有一个<strong>texture_loading</strong>的示例，然后我将该示例中读取文件的路径改成了<strong>compute_nbody</strong>中的那两张纹理才得以显示这两张图像的庐山真面目。不过事实上这还不够，因为我希望得到的是这两张纹理的jpg格式图像，但是<strong>texture_loading</strong>示例的展示效果并不是全屏纹理，而是一个空间中带有光照的四边形。。。好吧，没办法，我只能写一个渲染全屏四边形的着色器然后替换掉程序原来使用的那个着色器，最后终于得到了想要的全屏纹理！后续我就直接使用Windows自带的截屏工具截屏这个程序窗口中的纹理图像输出结果了，当然更好的办法肯定是将这个渲染结果直接写到一张jpg图像中去，后续可以去尝试完成这个操作，不过当下就暂且将就一下吧（因为实在是不想再搞了www。。。）</p><p>截屏获取了这两张纹理后，由于截屏得到的图像是png格式的，我最开始的时候随便找了个在线的png转jpg工具将这两张图像直接转为jpg格式然后放到我的程序中使用，结果就是报了已跳过nvoglv64.dll加载的错。于是乎我改变一种策略，直接采取最简单粗暴的办法：直接将截屏图像的后缀名改为.jpg。结果发现这样得到的图像文件竟然可以正常加载！困扰我一个上午的问题就这么不明不白地解决了（有那么亿点点摸不着头脑）。考虑到这是图像加载库本身的问题，我估计也想不明白具体缘由，所以一切正常那就万事大吉，result is everything!（</p><hr><h2 id="问题3文件路径读取错误">问题3：文件路径读取错误</h2><p>没时间庆祝上文那个大bug的修复了，接下来赶到战场的是文件路径读取问题。。。我发现自己的程序始终无法正常打开着色器文件和纹理文件。问题的原因倒是很明显，就是文件的相对路径指定错了，但是说实话最后调整到正确的相对路径还是费了我一番功夫（主要好像网上也没搜到具体讲这个的，可能是我太菜了。。。）。在我的项目组织里，生成最终可执行文件的<strong>main.cpp</strong>位于解决方案目录（也就是程序根目录）的<strong>Main</strong>文件夹中，而生成的最终可执行文件<strong>main.exe</strong>则是被我设置为了生成在解决方案目录下的<strong>bin</strong>文件夹下的<strong>Debug-x64</strong>子文件夹中。另外，所有的纹理文件都被存储在解决方案目录下的<strong>assets</strong>文件夹的<strong>textures</strong>子文件夹中，所有着色器文件都在解决方案目录下的<strong>Shaders</strong>文件夹中。一开始我以为项目文件中指定的相对路径应该是相对于<strong>main.exe</strong>所在位置的相对路径（事实上GPT也是这么告诉我的。。。），于是乎相对路径就应该指定为<code>../../assets/textures/xxx.jpg</code>，但实际情况就是这样设置相对路径是无法正确加载文件的。。。然后我尝试了一下<code>../assets/textures/xxx.jpg</code>这种路径设置，结果就正常加载了！（着色器文件也是这样）。我认为可能是因为项目文件中的相对路径相对的不是<strong>main.exe</strong>所在位置，而是<strong>main.cpp</strong>所在位置，当然这并没有经过验证，也望有经验的大佬路过指点一二。总之，这个问题算是解决了。</p><p>其实在这中间还有个小插曲，在中间反复试验相对路径失败后，我就想着要么直接用绝对路径吧，不过当然不可能直接在程序中硬编码我的电脑上的项目绝对路径（不然别人下载源码也用不了），于是我想着在项目属性页面将<strong>$(SolutionDir)</strong>设置为一个宏，然后在程序中使用这个宏。结果这么做之后，我发现这个宏在文件中展开之后路径名中的分隔符用的不是/而是，而众所周知c++字符串中，只能使用两个反斜杠转义，但问题就在于我设置的宏展开之后不是把，而是直接就把（只剩下字符串最后那个），这种情况下想要人工修正字符串都无从下手（我也不知道为什么会出现这种情况），也是让人很崩溃。后google了一下在程序中获取绝对路径的方法，发现好像都各有各的问题，还是需要人工转换修正一下字符串，觉得太麻烦了，遂放弃绝对路径，还是回去捣鼓相对路径了。。。</p><hr><h2 id="问题4opengl对象无法复制">问题4：OpenGL对象无法复制</h2><p>终于是扫清了程序主逻辑之外的一切障碍，本以为后续将是一马平川，但是马上OpenGL的不讲理直接崩溃式报错又是给了我一个大比兜。。。好吧图形程序的调试本来就是挺恶心的，这点我也见识过，也早有心理准备，不过又碰上了之后该无从下手还是无从下手。</p><p>然后我突然意识到，Vulkan有官方提供的调试层，OpenGL难道就没有类似物吗？结果一看还真有，OpenGL同样也可以设置debug用回调函数来输出API使用错误等程序有关信息，为啥我之前一直都没想着用呢？（还是太年轻。。。被多拷打几次就老实了）于是老老实实配置好debug回调函数，控制一下输出信息等级和范围（忽略一些不太重要的信息），并且写一个宏<i><font color="Red">GL_CALL</font></i>用于为回调函数添加错误发生所在文件和行数信息，这样一个初步的调试层就设置好了！接下来终于可以摆脱直接崩溃的噩梦，“愉快”地查看问题所在了！（后续我会不断完善调试层和异常类的开发，以便在程序崩溃的时候提供更加简明扼要且易于阅读的错误信息，个人认为<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1KC4y1Y7tc/?spm_id_from=333.1007.top_right_bar_window_default_collection.content.click"><code>chilli的d3d11教程</code></a>（B站上有人翻译）中提供了一个非常具有参考价值的异常类工程架构，之后可以试着仿照一下什么的，不得不感叹大佬nb！）</p><p>设置好调试层，然后一键运行程序，效果也是相当炸裂：由于图形程序会在一个渲染循环中不停运行，然后每一帧都会报错，导致运行个1秒左右命令行报错就能整出个几百行，那叫一个眼花缭乱。。。关键是，错误信息也是让人一头雾水：我的着色器和缓冲区等对象都已经成功创建并且对它们进行了绑定，怎么错误信息里一堆提示我绑定的不是一个OpenGL有效对象呢？明明经过我严格的测试，这些对象的创建过程本身没有任何问题，也是成功创建了，而且我也对它们执行了正常的绑定？（绑定就一行代码，我想着这也能出幺蛾子？？？）</p><p>于是我决定再着手写一个小的测试程序验证下。简单起见我直接在程序入口函数<strong>main</strong>中使用我自己封装的缓冲区类<i><font color="Orange">Buffer</font></i>创建了一个测试Storage buffer对象b，然后正常绑定b并且在计算着色器中使用b（写了一个简单的使用计算着色器改变粒子位置然后渲染粒子效果的测试程序），结果发现一切正常？？？这属实是让我极度迷惑：为啥同样是使用自己封装的缓冲类，使用方式还几乎一致，为什么我构建的项目就会疯狂报错？想了一个晚上没明白为什么，中间也对其它部分进行了各种各样琐碎的调试，但均无法解决这个问题，说实话也是整的我身心俱疲，一度想要切割了。。。</p><p>幸运的是，当天晚上临睡前我突然灵光一闪：我发现我在主程序中对封装对象的使用还是和在<strong>main</strong>函数中直接写的测试程序有区别的，区别就在于<strong>main</strong>函数中我是直接构造<i><font color="Orange">Buffer</font></i>对象，也就是说是直接调用了一次构造函数；而在主程序中需要用到的<i><font color="Orange">Buffer</font></i>对象是需要在程序对象的构造函数完成后，在后续的<i><font color="Green">prepare</font></i>函数中构建的，也就意味着在程序对象构造函数中调用了一次<i><font color="Orange">Buffer</font></i>的默认构造函数，然后在<i><font color="Green">prepare</font></i>函数中调用了它的默认拷贝赋值运算符才完成了真正意义上作为程序类成员的<i><font color="Orange">Buffer</font></i>对象的构建。（<i><font color="Orange">Buffer</font></i>的默认构造函数本身是没有什么意义的，当时给它添加一个这样的构造函数只是因为没有默认构造函数的话就没法完成程序类的构造函数，因为在程序类的构造函数中我不希望真正构建好<i><font color="Orange">Buffer</font></i>成员，但如果直接不构造<i><font color="Orange">Buffer</font></i>成员如果没有默认构造函数的话就会报错，因为该成员无法生成导致程序类不完整），当时我有一种预感，就是当<i><font color="Orange">Buffer</font></i>对象拷贝后，拷贝到的对象虽然拥有和原对象同样值的buffer ID（也就是<i><font color="Green">glGenBuffers</font></i>函数的第二个参数），但是它们的内存位置是不同的，这可能会导致绑定拷贝后对象时绑定的内存地址不是真正创建的缓冲区内存位置！于是我决定第二天早上来尝试一下自己的想法。</p><p>事实证明主要问题还真就出在这里！第二天，我略微改动了一下测试程序，刻意先默认构造再拷贝赋值缓冲区对象b，结果出现了主程序中一模一样的问题！可把我给激动坏了，总算是发现了问题的症结所在。于是我的改动方案是让所有封装的OpenGL对象类继承自一个共同的基类<i><font color="Orange">NoCopyable</font></i>，看名字也知道这个类的作用其实就是组织一切由它派生的子类的复制行为。实现起来也很简单，就是把该基类的所有赋值运算符全部设为delete的就行了。然后，我删除了所有这些OpenGL对象类的默认构造函数，并且把程序类中相应的类成员改用<strong>unique_ptr</strong>包装，这样就不用担心程序类构造函数调用时这些对象的初始化问题了，也防止了后续不经意的拷贝操作。</p><p>这样就解决了这个困扰了我将近半天的问题，确实是我之前从来没有注意过的刁钻问题（毕竟之前写OpenGL程序都是一个顺序大函数，不会出现这种拷贝赋值的情况。。。），也是给我好好上了一课。</p><hr><h2 id="问题5缓冲区数据复制性能问题">问题5：缓冲区数据复制性能问题</h2><p>不过命令行的报错信息远远没有到此结束。在解决了无法绑定到正确的OpenGL对象问题之后，情况是确实回调函数已经不再输出错误信息了，但是却出现了很多性能问题的警告，大体意思是说什么将数据从GPU local内存复制到host visible内存，对性能有影响blabla的，那这个指向性还是比较明确的，就是我原来在写<strong>compute_nbody</strong>项目的时候使用的存储计算结果的storage buffer和用于顶点数据的vertex buffer是分开的，最初的想法是storage buffer在存储好计算的结果之后将结果复制到vertex buffer中，供后续渲染使用。但是其实后面我发现OpenGL中缓冲区是可以随时改变绑定目标的（毕竟缓冲区本身只是一块只记录了所存储数据的内存区域），那么何不将计算完成后的Storage buffer重新绑定到<i><font color="Red">GL_ARRAY_BUFFER</font></i>后直接用于顶点缓冲呢？于是我就这么尝试了一下，发现确实可行，并且命令行也不再有任何警告信息了！如此黝黑寂静的命令行还真是让我感觉有点陌生了属于（笑。</p><hr><h2 id="问题6没有报错但黑屏">问题6：没有报错但黑屏</h2><p>在解决了命令行的调试信息之后，令人崩溃的是程序最终的显示结果仍然是黑屏。这种情况下一般就是渲染资源没有设置正确或者着色器效果不对什么的了，也是非常棘手的一类bug，因为它好像没有什么好的调试方法，只能挨个去判断设置的各个Uniform变量啥啥的值有没有问题之类的。事实上我最开始也就是按着这个思路做的，但并没能够找到任何蛛丝马迹，又是瞎忙活了快半天无功而反，也是给我整的十分emo。结果下午的时候我突然意识到，Vulkan的官方示例集中好像在设置渲染管线的时候是关闭了深度测试的，但是我并没有在我的程序中这么做。于是我赶快去试了试关闭深度缓冲，结果程序正常显示了！！！真是皇天不负有心人！当然我也并不能清楚地解释为什么关闭深度测试之后粒子就能够正常显示在屏幕上了（就算粒子之间会有遮挡关系我想至少也不应该是黑屏吧。。。），但是好在最后得到了正确的结果。当然，刚成功时的程序运行效果比现在的这个版本还要丑很多，效果不一致可能是因为在计算着色器中会使用程序一帧的运行时长<i><font color="Orange">delta_time</font></i>来计算当前帧粒子应该具有的速度和所在的位置，这个值在我的项目中当然和示例集可能会有很大的差距，最后得到的效果也就不尽相同。另外我的项目使用的窗口系统是<strong>glfw</strong>，而官方示例集是使用<strong>Windows API</strong>编写的窗口系统，所以显示上可能也会有差距。并且我所使用的粒子纹理是截屏得到和，和真正示例集中使用的纹理相比肯定也会有一些不同。总之为了效果尽可能好看些，我稍微调整了一下着色器参数，虽然还是达不到示例集中的效果，但至少相比最初好看多了！</p><p>另外，其实在这之前还有个小插曲，就是开始时我发现自己无法调整渲染的粒子的大小，反复调整着色器中的<i><font color="Orange">gl_PointSize</font></i>好像并没有作用。后面我发现自己是没有在设置OpenGL渲染选项的时候启用<i><font color="Red">GL_PROGRAM_POINT_SIZE</font></i>，也是没谁了。。。</p><hr><h2 id="结语">结语</h2><p>终于是在经过几天的不懈努力之后得到了想要的结果，经历了项目从0到1的架构之后感觉自己也确实学到了不少。后续我还会为这个项目添加上<strong>imgui</strong>支持以支持窗口化显示一些渲染信息之类的，总之这都是后话了。新的一年，再接再厉吧！</p><p>最后放上我的程序运行结果：</p><div id="dplayer3" class="dplayer hexo-tag-dplayer-mark" style="margin-bottom:20px"></div><script>!function(){var e=new DPlayer({container:document.getElementById("dplayer3"),loop:"yes",screenshot:"yes",video:{url:"/2025/02/07/CG_api/openGL/VKSample_OGL/compute_nbody/compute_nbody.mp4"},danmaku:{api:"https://api.prprpr.me/dplayer/"}});window.dplayers||(window.dplayers=[]),window.dplayers.push(e)}()</script><hr></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/CG-api/" class="category-chain-item">CG_api</a> <span>></span> <a href="/categories/CG-api/OpenGL/" class="category-chain-item">OpenGL</a> <span>></span> <a href="/categories/CG-api/OpenGL/VKSample-OGL/" class="category-chain-item">VKSample_OGL</a></span></span></div></div><div class="license-box my-3"><div class="license-title"><div>Compute_nBody的OpenGL复现</div><div>http://example.com/2025/02/07/CG_api/openGL/VKSample_OGL/compute_nbody/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>ZPC-dsg</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2025年2月7日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-cc-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2025/02/17/CG_api/d3d11/d3d11_with_windowsSDK/%E5%88%9D%E7%BA%A7%E7%AF%87%E7%BB%86%E8%8A%82%E8%A1%A5%E5%85%85/" title="post"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">post</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2025/01/24/articles/algo_techniques/%E6%96%87%E7%AB%A0%E6%B1%87%E6%80%BB1/" title="文章汇总"><span class="hidden-mobile">文章汇总</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>