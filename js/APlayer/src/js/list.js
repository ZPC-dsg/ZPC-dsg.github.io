import tplListItem from"../template/list-item.art";import utils from"./utils";import smoothScroll from"smoothscroll";class List{constructor(t){this.player=t,this.index=0,this.audios=this.player.options.audio,this.showing=!0,this.player.template.list.style.height=Math.min(this.player.template.list.scrollHeight,this.player.options.listMaxHeight)+"px",this.bindEvents()}bindEvents(){this.player.template.list.addEventListener("click",t=>{let e;e="LI"===t.target.tagName.toUpperCase()?t.target:t.target.parentElement;t=parseInt(e.getElementsByClassName("aplayer-list-index")[0].innerHTML)-1;t!==this.index?(this.switch(t),this.player.play()):this.player.toggle()})}show(){this.showing=!0,this.player.template.list.scrollTop=33*this.index,this.player.template.list.style.height=Math.min(this.player.template.list.scrollHeight,this.player.options.listMaxHeight)+"px",this.player.events.trigger("listshow")}hide(){this.showing=!1,this.player.template.list.style.height=Math.min(this.player.template.list.scrollHeight,this.player.options.listMaxHeight)+"px",setTimeout(()=>{this.player.template.list.style.height="0px",this.player.events.trigger("listhide")},0)}toggle(){this.showing?this.hide():this.show()}add(t){this.player.events.trigger("listadd",{audios:t}),(t="[object Array]"!==Object.prototype.toString.call(t)?[t]:t).map(t=>(t.name=t.name||t.title||"Audio name",t.artist=t.artist||t.author||"Audio artist",t.cover=t.cover||t.pic,t.type=t.type||"normal",t));var e=!(1<this.audios.length),i=0===this.audios.length;this.player.template.list.innerHTML+=tplListItem({theme:this.player.options.theme,audio:t,index:this.audios.length+1}),this.audios=this.audios.concat(t),e&&1<this.audios.length&&this.player.container.classList.add("aplayer-withlist"),this.player.randomOrder=utils.randomOrder(this.audios.length),this.player.template.listCurs=this.player.container.querySelectorAll(".aplayer-list-cur"),this.player.template.listCurs[this.audios.length-1].style.backgroundColor=t.theme||this.player.options.theme,i&&("random"===this.player.options.order?this.switch(this.player.randomOrder[0]):this.switch(0))}remove(e){if(this.player.events.trigger("listremove",{index:e}),this.audios[e])if(1<this.audios.length){var i=this.player.container.querySelectorAll(".aplayer-list li");i[e].remove(),this.audios.splice(e,1),this.player.lrc&&this.player.lrc.remove(e),e===this.index&&(this.audios[e]?this.switch(e):this.switch(e-1)),this.index>e&&this.index--;for(let t=e;t<i.length;t++)i[t].getElementsByClassName("aplayer-list-index")[0].textContent=t;1===this.audios.length&&this.player.container.classList.remove("aplayer-withlist"),this.player.template.listCurs=this.player.container.querySelectorAll(".aplayer-list-cur")}else this.clear()}switch(t){var e;this.player.events.trigger("listswitch",{index:t}),void 0!==t&&this.audios[t]&&(this.index=t,t=this.audios[this.index],this.player.template.pic.style.backgroundImage=t.cover?`url('${t.cover}')`:"",this.player.theme(this.audios[this.index].theme||this.player.options.theme,this.index,!1),this.player.template.title.innerHTML=t.name,this.player.template.author.innerHTML=t.artist?" - "+t.artist:"",(e=this.player.container.getElementsByClassName("aplayer-list-light")[0])&&e.classList.remove("aplayer-list-light"),this.player.container.querySelectorAll(".aplayer-list li")[this.index].classList.add("aplayer-list-light"),smoothScroll(33*this.index,500,null,this.player.template.list),this.player.setAudio(t),this.player.lrc&&this.player.lrc.switch(this.index),this.player.lrc&&this.player.lrc.update(0),1!==this.player.duration)&&(this.player.template.dtime.innerHTML=utils.secondToTime(this.player.duration))}clear(){this.player.events.trigger("listclear"),this.index=0,this.player.container.classList.remove("aplayer-withlist"),this.player.pause(),this.audios=[],this.player.lrc&&this.player.lrc.clear(),this.player.audio.src="",this.player.template.list.innerHTML="",this.player.template.pic.style.backgroundImage="",this.player.theme(this.player.options.theme,this.index,!1),this.player.template.title.innerHTML="No audio",this.player.template.author.innerHTML="",this.player.bar.set("loaded",0,"width"),this.player.template.dtime.innerHTML=utils.secondToTime(0)}}export default List;