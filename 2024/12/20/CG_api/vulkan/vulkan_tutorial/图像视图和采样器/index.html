<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/images/icon/mikuicon.jpg"><link rel="icon" href="/images/icon/mikuicon.jpg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="ZPC-dsg"><meta name="keywords" content=""><meta name="description" content="概要 本章我们将创建纹理采样所必须的两个资源——图像视图和采样器。图像视图在图像视图章节已经介绍过了，不过采样器对我们而言仍然是一个全新的知识，它主要控制着色器如何对纹理进行采样。本节我们就来分别创建上一章创建好的纹理所对应的这两个对象。 本节对应Vulkan Tutorial的Image view and sampler章节。  创建纹理图像视图 在图像视图章节中我们已经创建了一个工"><meta property="og:type" content="article"><meta property="og:title" content="图像视图和采样器"><meta property="og:url" content="http://example.com/2024/12/20/CG_api/vulkan/vulkan_tutorial/%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%92%8C%E9%87%87%E6%A0%B7%E5%99%A8/index.html"><meta property="og:site_name" content="ZPC の Blog"><meta property="og:description" content="概要 本章我们将创建纹理采样所必须的两个资源——图像视图和采样器。图像视图在图像视图章节已经介绍过了，不过采样器对我们而言仍然是一个全新的知识，它主要控制着色器如何对纹理进行采样。本节我们就来分别创建上一章创建好的纹理所对应的这两个对象。 本节对应Vulkan Tutorial的Image view and sampler章节。  创建纹理图像视图 在图像视图章节中我们已经创建了一个工"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/images/textbg/CG_api/vk_tuto_sampler.jpg"><meta property="article:published_time" content="2024-12-20T01:03:13.000Z"><meta property="article:modified_time" content="2024-12-20T05:17:13.731Z"><meta property="article:author" content="ZPC-dsg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://example.com/images/textbg/CG_api/vk_tuto_sampler.jpg"><meta name="referrer" content="no-referrer-when-downgrade"><title>图像视图和采样器 - ZPC の Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"example.com",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:"measurement_id:G-X8N3TZCB57",tencent:{sid:null,cid:null},leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script src="/live2d-widget/autoload.js"></script><meta name="generator" content="Hexo 7.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>ZPC の Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/images/textbg/CG_api/vk_tuto_sampler.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="图像视图和采样器"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> ZPC-dsg </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2024-12-20 09:03" pubdate>2024年12月20日 上午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 1.9k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 16 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">图像视图和采样器</h1><div class="markdown-body"><h2 id="概要">概要</h2><p>本章我们将创建纹理采样所必须的两个资源——图像视图和采样器。图像视图在<a target="_blank" rel="noopener" href="https://zpc-dsg.github.io/2024/11/11/CG_api/vulkan/vulkan_tutorial/%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE/">图像视图</a>章节已经介绍过了，不过采样器对我们而言仍然是一个全新的知识，它主要控制着色器如何对纹理进行采样。本节我们就来分别创建<a target="_blank" rel="noopener" href="https://zpc-dsg.github.io/2024/12/12/CG_api/vulkan/vulkan_tutorial/%E5%9B%BE%E5%83%8F/">上一章</a>创建好的纹理所对应的这两个对象。</p><p>本节对应Vulkan Tutorial的<a target="_blank" rel="noopener" href="https://vulkan-tutorial.com/Texture_mapping/Image_view_and_sampler">Image view and sampler</a>章节。</p><hr><h2 id="创建纹理图像视图">创建纹理图像视图</h2><p>在<a target="_blank" rel="noopener" href="https://zpc-dsg.github.io/2024/11/11/CG_api/vulkan/vulkan_tutorial/%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE/">图像视图</a>章节中我们已经创建了一个工具函数<i><font color="Green">createImageViews</font></i>来创建交换链中所有图像各自所需的图像视图。这里我们完全可以重用其中的代码来创建<a target="_blank" rel="noopener" href="https://zpc-dsg.github.io/2024/12/12/CG_api/vulkan/vulkan_tutorial/%E5%9B%BE%E5%83%8F/">上一章</a>创建的纹理对象对应的图像视图。在类内新建一个<i><font color="Green">VkImageView createImageView(VkImage image, VkFormat format)</font></i>函数来提取出创建一个图像视图所需的代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">VkImageView <span class="hljs-title">createImageView</span><span class="hljs-params">(VkImage image, VkFormat format)</span> </span>&#123;<br>    VkImageViewCreateInfo viewInfo&#123;&#125;;<br>    viewInfo.sType = VK_STRUCTURE_TYPE_IMAGE_VIEW_CREATE_INFO;<br>    viewInfo.image = image;<br>    viewInfo.viewType = VK_IMAGE_VIEW_TYPE_2D;<br>    viewInfo.format = format;<br>    viewInfo.subresourceRange.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;<br>    viewInfo.subresourceRange.baseMipLevel = <span class="hljs-number">0</span>;<br>    viewInfo.subresourceRange.levelCount = <span class="hljs-number">1</span>;<br>    viewInfo.subresourceRange.baseArrayLayer = <span class="hljs-number">0</span>;<br>    viewInfo.subresourceRange.layerCount = <span class="hljs-number">1</span>;<br><br>    VkImageView imageView;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">vkCreateImageView</span>(device, &amp;viewInfo, <span class="hljs-literal">nullptr</span>, &amp;imageView) != VK_SUCCESS) &#123;<br>        <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">&quot;failed to create texture image view!&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> imageView;<br>&#125;<br></code></pre></td></tr></table></figure><p>在类内新添一个成员<i><font color="Orange">textureImageView</font></i>来保存将要构建的纹理图像视图对象，并且新添一个<i><font color="Green">void createTextureImageView()</font></i>函数来进行创建纹理视图有关的工作，于是该函数的代码可以简单地写成：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">createTextureImageView</span><span class="hljs-params">()</span> </span>&#123;<br>    textureImageView = <span class="hljs-built_in">createImageView</span>(textureImage, VK_FORMAT_R8G8B8A8_SRGB);<br>&#125;<br></code></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://zpc-dsg.github.io/2024/11/11/CG_api/vulkan/vulkan_tutorial/%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE/">图像视图</a>章节创建的<i><font color="Green">createImageViews</font></i>函数现在也可以简化为：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">createImageViews</span><span class="hljs-params">()</span> </span>&#123;<br>    swapChainImageViews.<span class="hljs-built_in">resize</span>(swapChainImages.<span class="hljs-built_in">size</span>());<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> i = <span class="hljs-number">0</span>; i &lt; swapChainImages.<span class="hljs-built_in">size</span>(); i++) &#123;<br>        swapChainImageViews[i] = <span class="hljs-built_in">createImageView</span>(swapChainImages[i], swapChainImageFormat);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>这样就创建好了纹理对象的图像视图。</p><hr><h2 id="创建采样器">创建采样器</h2><p>事实上着色器也可以直接采样纹理，但是使用采样器进行采样几乎总是更好的选择，因为采样器会对图片进行合适的过滤和变换，然后将处理后的颜色递交给着色器以达到更好的图像质量。当图像过采样或者采样不足时，采样器会自动使用设置好的过滤模式对图像颜色进行过滤；当着色器采样到图像之外的点时，采样器会使用预先设置好的<strong>解决模式（Addressing mode）</strong>来决定此时的采样行为和最终结果。关于这一部分内容，这里假设读者已经有了一个基本的概念，不再赘述，不熟悉的读者可以参考<a target="_blank" rel="noopener" href="https://learnopengl.com/Getting-started/Textures">这篇文章</a>。</p><p>接下来我们在类内创建一个<a target="_blank" rel="noopener" href="https://registry.khronos.org/vulkan/specs/latest/man/html/VkSampler.html"><code>VkSampler</code></a>类型的<i><font color="Orange">textureSampler</font></i>成员来储存纹理采样器，并且创建一个<i><font color="Green">void createTextureSampler()</font></i>函数来创建该采样器。创建采样器的过程很简单，我们只需要填写相应的信息结构体<a target="_blank" rel="noopener" href="https://registry.khronos.org/vulkan/specs/latest/man/html/VkSamplerCreateInfo.html"><code>VkSamplerCreateInfo</code></a>即可，该结构体定义如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Provided by VK_VERSION_1_0</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VkSamplerCreateInfo</span> &#123;</span><br>    VkStructureType         sType;<br>    <span class="hljs-type">const</span> <span class="hljs-type">void</span>*             pNext;<br>    VkSamplerCreateFlags    flags;<br>    VkFilter                magFilter;<br>    VkFilter                minFilter;<br>    VkSamplerMipmapMode     mipmapMode;<br>    VkSamplerAddressMode    addressModeU;<br>    VkSamplerAddressMode    addressModeV;<br>    VkSamplerAddressMode    addressModeW;<br>    <span class="hljs-type">float</span>                   mipLodBias;<br>    VkBool32                anisotropyEnable;<br>    <span class="hljs-type">float</span>                   maxAnisotropy;<br>    VkBool32                compareEnable;<br>    VkCompareOp             compareOp;<br>    <span class="hljs-type">float</span>                   minLod;<br>    <span class="hljs-type">float</span>                   maxLod;<br>    VkBorderColor           borderColor;<br>    VkBool32                unnormalizedCoordinates;<br>&#125; VkSamplerCreateInfo;<br></code></pre></td></tr></table></figure><p><i><font color="Orange">flags</font></i>可能的取值如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Provided by VK_VERSION_1_0</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">VkSamplerCreateFlagBits</span> &#123;</span><br>  <span class="hljs-comment">// Provided by VK_EXT_fragment_density_map</span><br>    VK_SAMPLER_CREATE_SUBSAMPLED_BIT_EXT = <span class="hljs-number">0x00000001</span>,<span class="hljs-comment">//表示采样器支持子采样（即从原始图像中选择一部分像素进行处理，而忽略其他像素）。这通常用于减少渲染负担，特别是在高分辨率的场景中</span><br>  <span class="hljs-comment">// Provided by VK_EXT_fragment_density_map</span><br>    VK_SAMPLER_CREATE_SUBSAMPLED_COARSE_RECONSTRUCTION_BIT_EXT = <span class="hljs-number">0x00000002</span>,<span class="hljs-comment">//表示采样器支持粗略重建的子采样</span><br>  <span class="hljs-comment">// Provided by VK_EXT_descriptor_buffer</span><br>    VK_SAMPLER_CREATE_DESCRIPTOR_BUFFER_CAPTURE_REPLAY_BIT_EXT = <span class="hljs-number">0x00000008</span>,<span class="hljs-comment">//表示采样器支持描述符缓冲区的捕获和重放（指将描述符缓冲区的状态（即绑定的资源和参数）保存下来，以便在后续的渲染操作中重新使用）。这有助于在图形管线中更高效地管理资源</span><br>  <span class="hljs-comment">// Provided by VK_EXT_non_seamless_cube_map</span><br>    VK_SAMPLER_CREATE_NON_SEAMLESS_CUBE_MAP_BIT_EXT = <span class="hljs-number">0x00000004</span>,<span class="hljs-comment">//表示采样器支持非无缝的立方体贴图。这意味着在采样立方体贴图时，边缘可能会有可见的接缝</span><br>  <span class="hljs-comment">// Provided by VK_QCOM_image_processing</span><br>    VK_SAMPLER_CREATE_IMAGE_PROCESSING_BIT_QCOM = <span class="hljs-number">0x00000010</span>,<span class="hljs-comment">//表示采样器支持图像处理功能。这可能涉及对图像进行各种处理操作，例如滤波或转换</span><br>&#125; VkSamplerCreateFlagBits;<br></code></pre></td></tr></table></figure><p>接下来的<i><font color="Orange">magFilter</font></i>和<i><font color="Orange">minFilter</font></i>分别指定放大和缩小图像时的过滤模式。可能选取的过滤模式有以下几种：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Provided by VK_VERSION_1_0</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">VkFilter</span> &#123;</span><br>    VK_FILTER_NEAREST = <span class="hljs-number">0</span>,<br>    VK_FILTER_LINEAR = <span class="hljs-number">1</span>,<br>  <span class="hljs-comment">// Provided by VK_EXT_filter_cubic</span><br>    VK_FILTER_CUBIC_EXT = <span class="hljs-number">1000015000</span>,<br>  <span class="hljs-comment">// Provided by VK_IMG_filter_cubic</span><br>    VK_FILTER_CUBIC_IMG = VK_FILTER_CUBIC_EXT,<br>&#125; VkFilter;<br></code></pre></td></tr></table></figure><p><i><font color="Orange">mipmapMode</font></i>、<i><font color="Orange">mipLodBias</font></i>、<i><font color="Orange">minLod</font></i>、<i><font color="Orange">maxLod</font></i>均与多级渐远纹理有关，在后续介绍Vulkan中的多级渐远时我们会详细介绍这一部分。</p><p>接下来的三个addressMode用于指定采样超出图像范围的解决模式，可能的取值有如下几种，它们的作用和效果基本上在<a target="_blank" rel="noopener" href="https://learnopengl.com/Getting-started/Textures">这篇文章</a>中都有提及：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Provided by VK_VERSION_1_0</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">VkSamplerAddressMode</span> &#123;</span><br>    VK_SAMPLER_ADDRESS_MODE_REPEAT = <span class="hljs-number">0</span>,<br>    VK_SAMPLER_ADDRESS_MODE_MIRRORED_REPEAT = <span class="hljs-number">1</span>,<br>    VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_EDGE = <span class="hljs-number">2</span>,<br>    VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_BORDER = <span class="hljs-number">3</span>,<br>  <span class="hljs-comment">// Provided by VK_VERSION_1_2, VK_KHR_sampler_mirror_clamp_to_edge</span><br>    VK_SAMPLER_ADDRESS_MODE_MIRROR_CLAMP_TO_EDGE = <span class="hljs-number">4</span>,<br>  <span class="hljs-comment">// Provided by VK_KHR_sampler_mirror_clamp_to_edge</span><br>  <span class="hljs-comment">// VK_SAMPLER_ADDRESS_MODE_MIRROR_CLAMP_TO_EDGE_KHR is a deprecated alias</span><br>    VK_SAMPLER_ADDRESS_MODE_MIRROR_CLAMP_TO_EDGE_KHR = VK_SAMPLER_ADDRESS_MODE_MIRROR_CLAMP_TO_EDGE,<br>&#125; VkSamplerAddressMode;<br></code></pre></td></tr></table></figure><p><i><font color="Orange">compareEnable</font></i>和<i><font color="Orange">compareOp</font></i>指定图像颜色和一个固定颜色的比较操作，这在有些应用情景下是有用的，比如<strong>PCF(percentage-closer filtering)</strong>（可以参考<a target="_blank" rel="noopener" href="https://developer.nvidia.com/gpugems/gpugems/part-ii-lighting-and-shadows/chapter-11-shadow-map-antialiasing">这篇文章</a>或者<a target="_blank" rel="noopener" href="https://learnopengl.com/Advanced-Lighting/Shadows/Shadow-Mapping">这篇文章</a>来初步了解PCF，<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1YK4y1T7yY?vd_source=96b763f75b621baa119e5118b6164aee&amp;p=3&amp;spm_id_from=333.788.videopod.episodes">games202</a>中有包括PCF在内的更多关于阴影处理技术的拓展）。</p><p><i><font color="Orange">borderColor</font></i>指定当解决模式设置为夹紧到边界有关的模式时使用的边界颜色。事实上这个颜色不能是任意值，而是必须为以下取值：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Provided by VK_VERSION_1_0</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">VkBorderColor</span> &#123;</span><br>    VK_BORDER_COLOR_FLOAT_TRANSPARENT_BLACK = <span class="hljs-number">0</span>,<br>    VK_BORDER_COLOR_INT_TRANSPARENT_BLACK = <span class="hljs-number">1</span>,<br>    VK_BORDER_COLOR_FLOAT_OPAQUE_BLACK = <span class="hljs-number">2</span>,<br>    VK_BORDER_COLOR_INT_OPAQUE_BLACK = <span class="hljs-number">3</span>,<br>    VK_BORDER_COLOR_FLOAT_OPAQUE_WHITE = <span class="hljs-number">4</span>,<br>    VK_BORDER_COLOR_INT_OPAQUE_WHITE = <span class="hljs-number">5</span>,<br>  <span class="hljs-comment">// Provided by VK_EXT_custom_border_color</span><br>    VK_BORDER_COLOR_FLOAT_CUSTOM_EXT = <span class="hljs-number">1000287003</span>,<br>  <span class="hljs-comment">// Provided by VK_EXT_custom_border_color</span><br>    VK_BORDER_COLOR_INT_CUSTOM_EXT = <span class="hljs-number">1000287004</span>,<br>&#125; VkBorderColor;<br></code></pre></td></tr></table></figure><p><i><font color="Orange">unnormalizedCoordinates</font></i>决定纹理坐标的范围。如果设置为<i><font color="Red">VK_TRUE</font></i>则代表纹理各维度坐标将是0到该维度像素数这个范围，一般我们都设置为<i><font color="Red">VK_FALSE</font></i>，此时纹理坐标范围为[0,1)，与图像像素多少无关。</p><p>最后我们来看成员<i><font color="Orange">anisotrophyEnable</font></i>和<i><font color="Orange">maxAnisotropy</font></i>，这两个成员和各向异性滤波有关。所谓各向异性滤波，指的是一种纹理过滤技术，通过动态调整过滤级别和加权平均样本从而改善斜角表面上纹理的质量。与之前成员不同的是，各向异性滤波涉及到GPU特性，需要我们手动开启才能使用（如果不开启直接使用验证层会报错），于是我们需要首先在<i><font color="Green">createLogicalDevice</font></i>函数中手动启用这个特性：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++">VkPhysicalDeviceFeatures deviceFeatures&#123;&#125;;<br>deviceFeatures.samplerAnisotropy = VK_TRUE;<br><br><span class="hljs-comment">//...</span><br><br>VkDeviceCreateInfo createInfo&#123;&#125;;<br>createInfo.pEnabledFeatures = &amp;deviceFeatures;<br><span class="hljs-comment">//...</span><br></code></pre></td></tr></table></figure><p>当然，严格来讲我们应该还需要在开启这个特性之前先检查一下GPU是否支持该特性（这个特性几乎被所有的现代GPU所支持，所以大多数情况不去检查也没有大问题，不过为了完整性和严谨性起见我们还是添加上检查代码），于是在<i><font color="Green">isDeviceSuitable</font></i>中添加上检查硬件是否支持该特性的代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//...</span><br><br>VkPhysicalDeviceFeatures supportedFeatures;<br><span class="hljs-built_in">vkGetPhysicalDeviceFeatures</span>(device, &amp;supportedFeatures);<br><br><span class="hljs-keyword">return</span> indices.<span class="hljs-built_in">isComplete</span>() &amp;&amp; extensionsSupported &amp;&amp; swapChainAdequate &amp;&amp; supportedFeatures.samplerAnisotropy;<br></code></pre></td></tr></table></figure><p>这样我们就可以在创建采样器时开启该特性了。当然，除非出于性能考虑，不然我们没有理由不开启各向异性过滤来提高纹理采样质量。另外，启用该特性后，我们还需要查询设备所支持的各向异性滤波采样数目的最大值以填写<i><font color="Orange">maxAnisotropy</font></i>成员，这同样可以通过查询GPU特性来实现。于是我们填写该信息结构体的代码如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c++">VkSamplerCreateInfo samplerInfo&#123;&#125;;<br>samplerInfo.sType = VK_STRUCTURE_TYPE_SAMPLER_CREATE_INFO;<br>samplerInfo.magFilter = VK_FILTER_LINEAR;<br>samplerInfo.minFilter = VK_FILTER_LINEAR;<br>samplerInfo.addressModeU = VK_SAMPLER_ADDRESS_MODE_REPEAT;<br>samplerInfo.addressModeV = VK_SAMPLER_ADDRESS_MODE_REPEAT;<br>samplerInfo.addressModeW = VK_SAMPLER_ADDRESS_MODE_REPEAT;<br><br>samplerInfo.anisotropyEnable = VK_TRUE;<br>VkPhysicalDeviceProperties properties&#123;&#125;;<br><span class="hljs-built_in">vkGetPhysicalDeviceProperties</span>(physicalDevice, &amp;properties);<br>samplerInfo.maxAnisotropy = properties.limits.maxSamplerAnisotropy;<br><br>samplerInfo.borderColor = VK_BORDER_COLOR_INT_OPAQUE_BLACK;<br>samplerInfo.unnormalizedCoordinates = VK_FALSE;<br>samplerInfo.compareEnable = VK_FALSE;<br>samplerInfo.compareOp = VK_COMPARE_OP_ALWAYS;<br><br>samplerInfo.mipmapMode = VK_SAMPLER_MIPMAP_MODE_LINEAR;<br>samplerInfo.mipLodBias = <span class="hljs-number">0.0f</span>;<br>samplerInfo.minLod = <span class="hljs-number">0.0f</span>;<br>samplerInfo.maxLod = <span class="hljs-number">0.0f</span>;<br></code></pre></td></tr></table></figure><p>然后我们就可以使用<a target="_blank" rel="noopener" href="https://registry.khronos.org/vulkan/specs/latest/man/html/vkCreateSampler.html"><code>vkCreateSampler</code></a>创建所需的采样器对象了：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">if</span> (<span class="hljs-built_in">vkCreateSampler</span>(device, &amp;samplerInfo, <span class="hljs-literal">nullptr</span>, &amp;textureSampler) != VK_SUCCESS) &#123;<br>    <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">&quot;failed to create texture sampler!&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>大功告成！</p><hr><p>--<a target="_blank" rel="noopener" href="https://zpc-dsg.github.io/2024/12/12/CG_api/vulkan/vulkan_tutorial/%E5%9B%BE%E5%83%8F/">上一篇：图像</a></p><p>--<a target="_blank" rel="noopener" href="https://zpc-dsg.github.io/2024/12/20/CG_api/vulkan/vulkan_tutorial/%E7%BB%84%E5%90%88%E5%9B%BE%E5%83%8F%E9%87%87%E6%A0%B7%E5%99%A8/">下一篇：组合图像采样器</a></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/CG-api/" class="category-chain-item">CG_api</a> <span>></span> <a href="/categories/CG-api/vulkan/" class="category-chain-item">vulkan</a> <span>></span> <a href="/categories/CG-api/vulkan/vulkan-tutorial/" class="category-chain-item">vulkan_tutorial</a></span></span></div></div><div class="license-box my-3"><div class="license-title"><div>图像视图和采样器</div><div>http://example.com/2024/12/20/CG_api/vulkan/vulkan_tutorial/图像视图和采样器/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>ZPC-dsg</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2024年12月20日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-cc-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2024/12/20/CG_api/vulkan/vulkan_tutorial/%E7%BB%84%E5%90%88%E5%9B%BE%E5%83%8F%E9%87%87%E6%A0%B7%E5%99%A8/" title="组合图像采样器"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">组合图像采样器</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2024/12/12/CG_api/vulkan/vulkan_tutorial/%E5%9B%BE%E5%83%8F/" title="图像"><span class="hidden-mobile">图像</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>